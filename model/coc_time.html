<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clash of Clans Upgrade Tracker</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        h1 {
            color: #c90;
            text-align: center;
            margin-bottom: 30px;
        }
        .section {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .section-title {
            color: #c90;
            border-bottom: 2px solid #c90;
            padding-bottom: 5px;
            margin-top: 0;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            background-color: #c90;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            display: block;
            margin: 20px auto;
        }
        button:hover {
            background-color: #b80;
        }
        .upgrade-list {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .upgrade-list th {
            background-color: #c90;
            color: white;
            text-align: left;
            padding: 10px;
        }
        .upgrade-list td {
            padding: 10px;
            border-bottom: 1px solid #ddd;
        }
        .upgrade-list tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .clock-tower {
            font-weight: bold;
            color: #c90;
        }
        .error {
            color: red;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>Clash of Clans Upgrade Tracker</h1>
    
    <div class="section">
        <h2 class="section-title">Upgrade Information</h2>
        
        <div class="form-group">
            <label for="main-count">Number of Main Base upgrades:</label>
            <input type="number" id="main-count" min="0" value="0">
        </div>
        
        <div class="form-group">
            <label for="builder-count">Number of Builder Base upgrades:</label>
            <input type="number" id="builder-count" min="0" value="0">
        </div>
        
        <div id="main-base-container"></div>
        <div id="builder-base-container"></div>
        
        <button id="calculate-btn">Calculate Schedule</button>
    </div>
    
    <div class="section" id="results-section" style="display: none;">
        <h2 class="section-title">Upgrade Schedule</h2>
        <table class="upgrade-list">
            <thead>
                <tr>
                    <th>Upgrade</th>
                    <th>Completion Time</th>
                </tr>
            </thead>
            <tbody id="results-table">
            </tbody>
        </table>
    </div>

    <script>
        // Constants
        const BOOST_SAVING = 198; // 3h18m in minutes (Level 5 Clock Tower)
        const BOOST_COOLDOWN = 22 * 60; // 22 hours in minutes
        
        // DOM elements
        const mainCountInput = document.getElementById('main-count');
        const builderCountInput = document.getElementById('builder-count');
        const mainBaseContainer = document.getElementById('main-base-container');
        const builderBaseContainer = document.getElementById('builder-base-container');
        const calculateBtn = document.getElementById('calculate-btn');
        const resultsSection = document.getElementById('results-section');
        const resultsTable = document.getElementById('results-table');
        
        // Event listeners
        mainCountInput.addEventListener('change', () => createInputFields('main'));
        builderCountInput.addEventListener('change', () => createInputFields('builder'));
        calculateBtn.addEventListener('click', calculateSchedule);
        
        // Create input fields based on count
        function createInputFields(baseType) {
            const count = baseType === 'main' 
                ? parseInt(mainCountInput.value) 
                : parseInt(builderCountInput.value);
            const container = baseType === 'main' ? mainBaseContainer : builderBaseContainer;
            
            container.innerHTML = '';
            
            if (count > 0) {
                const title = document.createElement('h3');
                title.textContent = baseType === 'main' ? 'Main Base Upgrades' : 'Builder Base Upgrades';
                container.appendChild(title);
                
                if (baseType === 'builder') {
                    const clockTowerGroup = document.createElement('div');
                    clockTowerGroup.className = 'form-group';
                    clockTowerGroup.innerHTML = `
                        <label for="clock-tower-time">Time until next Clock Tower boost (hours minutes):</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="number" id="clock-tower-hours" min="0" max="22" placeholder="Hours" style="flex: 1;">
                            <input type="number" id="clock-tower-minutes" min="0" max="59" placeholder="Minutes" style="flex: 1;">
                        </div>
                    `;
                    container.appendChild(clockTowerGroup);
                }
                
                for (let i = 0; i < count; i++) {
                    const upgradeGroup = document.createElement('div');
                    upgradeGroup.className = 'form-group';
                    upgradeGroup.innerHTML = `
                        <h4>Upgrade ${i + 1}</h4>
                        <label for="${baseType}-name-${i}">Name:</label>
                        <input type="text" id="${baseType}-name-${i}" required>
                        
                        <label for="${baseType}-time-${i}">Time (days hours minutes):</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="number" id="${baseType}-days-${i}" min="0" placeholder="Days" style="flex: 1;">
                            <input type="number" id="${baseType}-hours-${i}" min="0" max="23" placeholder="Hours" style="flex: 1;">
                            <input type="number" id="${baseType}-minutes-${i}" min="0" max="59" placeholder="Minutes" style="flex: 1;">
                        </div>
                    `;
                    container.appendChild(upgradeGroup);
                }
            }
        }
        
        // Calculate builder base completion time with boosts
        function calculateBuilderCompletion(days, hours, minutes, boostAvailableTime) {
            const totalMinutes = days * 24 * 60 + hours * 60 + minutes;
            const currentTime = new Date();
            let remainingMinutes = totalMinutes;
            let elapsedMinutes = 0;
            let nextBoostTime = boostAvailableTime;
            
            while (remainingMinutes > 0) {
                if (nextBoostTime <= new Date(currentTime.getTime() + elapsedMinutes * 60000)) {
                    // Apply boost
                    remainingMinutes -= BOOST_SAVING;
                    if (remainingMinutes <= 0) break;
                    
                    // Set next boost time
                    nextBoostTime = new Date(nextBoostTime.getTime() + BOOST_COOLDOWN * 60000);
                }
                
                // Progress time
                const timeUntilNextBoost = (nextBoostTime - (currentTime.getTime() + elapsedMinutes * 60000)) / 60000;
                const minutesToProgress = Math.min(remainingMinutes, timeUntilNextBoost > 0 ? timeUntilNextBoost : remainingMinutes);
                
                elapsedMinutes += minutesToProgress;
                remainingMinutes -= minutesToProgress;
            }
            
            const finishTime = new Date(currentTime.getTime() + elapsedMinutes * 60000);
            return { finishTime, nextBoostTime };
        }
        
        // Format date for display
        function formatDate(date) {
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const month = months[date.getMonth()];
            const day = date.getDate();
            
            let hours = date.getHours();
            const ampm = hours >= 12 ? 'PM' : 'AM';
            hours = hours % 12;
            hours = hours ? hours : 12; // Convert 0 to 12
            
            const minutes = date.getMinutes().toString().padStart(2, '0');
            
            return `(${month} ${day}) ${hours}:${minutes} ${ampm}`;
        }
        
        // Main calculation function
        function calculateSchedule() {
            const mainCount = parseInt(mainCountInput.value);
            const builderCount = parseInt(builderCountInput.value);
            
            if (isNaN(mainCount)) {
                alert('Please enter a valid number for Main Base upgrades');
                return;
            }
            
            if (isNaN(builderCount)) {
                alert('Please enter a valid number for Builder Base upgrades');
                return;
            }
            
            const upgrades = [];
            const now = new Date();
            
            // Process Main Base upgrades
            for (let i = 0; i < mainCount; i++) {
                const name = document.getElementById(`main-name-${i}`).value;
                const days = parseInt(document.getElementById(`main-days-${i}`).value) || 0;
                const hours = parseInt(document.getElementById(`main-hours-${i}`).value) || 0;
                const minutes = parseInt(document.getElementById(`main-minutes-${i}`).value) || 0;
                
                if (!name) {
                    alert(`Please enter a name for Main Base upgrade ${i + 1}`);
                    return;
                }
                
                const totalMinutes = days * 24 * 60 + hours * 60 + minutes;
                const finishTime = new Date(now.getTime() + totalMinutes * 60000);
                
                upgrades.push({
                    name,
                    finishTime,
                    isClockTower: false
                });
            }
            
            // Process Builder Base upgrades
            if (builderCount > 0) {
                const ctHours = parseInt(document.getElementById('clock-tower-hours').value) || 0;
                const ctMinutes = parseInt(document.getElementById('clock-tower-minutes').value) || 0;
                let boostAvailableTime = new Date(now.getTime() + (ctHours * 60 + ctMinutes) * 60000);
                
                for (let i = 0; i < builderCount; i++) {
                    const name = document.getElementById(`builder-name-${i}`).value;
                    const days = parseInt(document.getElementById(`builder-days-${i}`).value) || 0;
                    const hours = parseInt(document.getElementById(`builder-hours-${i}`).value) || 0;
                    const minutes = parseInt(document.getElementById(`builder-minutes-${i}`).value) || 0;
                    
                    if (!name) {
                        alert(`Please enter a name for Builder Base upgrade ${i + 1}`);
                        return;
                    }
                    
                    const result = calculateBuilderCompletion(days, hours, minutes, boostAvailableTime);
                    upgrades.push({
                        name,
                        finishTime: result.finishTime,
                        isClockTower: false
                    });
                    
                    boostAvailableTime = result.nextBoostTime;
                }
                
                // Add Clock Tower entry
                upgrades.push({
                    name: 'Clock Tower Boost Ready',
                    finishTime: boostAvailableTime,
                    isClockTower: true
                });
            }
            
            // Sort upgrades by completion time
            upgrades.sort((a, b) => a.finishTime - b.finishTime);
            
            // Display results
            resultsTable.innerHTML = '';
            upgrades.forEach(upgrade => {
                const row = document.createElement('tr');
                if (upgrade.isClockTower) {
                    row.innerHTML = `
                        <td class="clock-tower">${upgrade.name}</td>
                        <td>${formatDate(upgrade.finishTime)}</td>
                    `;
                } else {
                    row.innerHTML = `
                        <td>${upgrade.name}</td>
                        <td>${formatDate(upgrade.finishTime)}</td>
                    `;
                }
                resultsTable.appendChild(row);
            });
            
            resultsSection.style.display = 'block';
        }
    </script>
</body>
</html>